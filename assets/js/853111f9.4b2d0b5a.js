"use strict";(self.webpackChunkchanterelle_doc=self.webpackChunkchanterelle_doc||[]).push([[2883],{4192:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"references/handler_io","title":"handler_io.py","description":"Overview","source":"@site/docs/references/handler_io.md","sourceDirName":"references","slug":"/references/handler_io","permalink":"/docs/references/handler_io","draft":false,"unlisted":false,"editUrl":"https://github.com/chanterelle-io/chanterelle/tree/main/packages/create-docusaurus/templates/shared/docs/references/handler_io.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Model Findings","permalink":"/docs/references/model_findings"}}');var s=r(4848),t=r(8453);const d={},l="handler_io.py",o={},c=[{value:"Overview",id:"overview",level:2},{value:"File Structure",id:"file-structure",level:2},{value:"1. <code>model_fn</code>",id:"1-model_fn",level:3},{value:"2. <code>init_resources_fn</code> (optional)",id:"2-init_resources_fn-optional",level:3},{value:"3. <code>input_fn</code>",id:"3-input_fn",level:3},{value:"4. <code>predict_fn</code>",id:"4-predict_fn",level:3},{value:"5. <code>output_fn</code>",id:"5-output_fn",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Chanterelle Integration",id:"chanterelle-integration",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"handler_iopy",children:"handler_io.py"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"handler_io.py"})," file is designed to implement handler functions for machine learning models. These functions are used to load the model, process input data, make predictions, and format outputs. The file is structured to ensure modularity and reusability."]}),"\n",(0,s.jsx)(n.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,s.jsx)(n.p,{children:"The file contains the following key functions:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Required Handler Functions"}),": ",(0,s.jsx)(n.code,{children:"model_fn"}),", ",(0,s.jsx)(n.code,{children:"input_fn"}),", ",(0,s.jsx)(n.code,{children:"predict_fn"}),", ",(0,s.jsx)(n.code,{children:"output_fn"}),".\r\n",(0,s.jsx)(n.strong,{children:"Optional Handler Functions"}),": ",(0,s.jsx)(n.code,{children:"init_resources_fn"}),"."]}),"\n",(0,s.jsxs)(n.h3,{id:"1-model_fn",children:["1. ",(0,s.jsx)(n.code,{children:"model_fn"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Load the machine learning model from the specified directory."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"model_dir"})," - Directory containing the model files."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def model_fn(model_dir):\r\n    import joblib\r\n    import os\r\n    model_path = os.path.join(model_dir, 'model.joblib')\r\n    predictor = joblib.load(model_path)\r\n    return predictor\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"2-init_resources_fn-optional",children:["2. ",(0,s.jsx)(n.code,{children:"init_resources_fn"})," (optional)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Load additional resources (e.g., lookup tables) during initialization.\r\n",(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"model_dir"})," - Directory containing the model and additional resources."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Load JSON files or other resources."}),"\n",(0,s.jsx)(n.li,{children:"Handle exceptions gracefully."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def init_resources_fn(model_dir):\r\n    import json\r\n    import os\r\n    resources = {}\r\n    \r\n    resources_path = os.path.join(model_dir, 'lookup_dict.json')\r\n    if os.path.exists(resources_path):\r\n        with open(resources_path, 'r') as f:\r\n            resources['lookup_dict'] = json.load(f)\r\n    \r\n    return resources\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"3-input_fn",children:["3. ",(0,s.jsx)(n.code,{children:"input_fn"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Transform raw input data into a format suitable for the model.\r\n",(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"request_data"})," - Input data from the request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resources"})," (optional) - Additional resources loaded by ",(0,s.jsx)(n.code,{children:"init_resources_fn"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Normalize and validate input data."}),"\n",(0,s.jsx)(n.li,{children:"Extract and build features."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def input_fn(request_data, resources):\r\n    // ... Extract features from request_data\r\n    return features_data\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"4-predict_fn",children:["4. ",(0,s.jsx)(n.code,{children:"predict_fn"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Run predictions using the loaded model.\r\n",(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"input_data"})," - The processed input data from ",(0,s.jsx)(n.code,{children:"input_fn"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"model"})," - The loaded model from ",(0,s.jsx)(n.code,{children:"model_fn"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resources"})," (optional) - Additional resources loaded by ",(0,s.jsx)(n.code,{children:"init_resources_fn"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Make predictions using the model."}),"\n",(0,s.jsx)(n.li,{children:"Handle sensitivity analysis."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"output = model.predict(input_data)\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"5-output_fn",children:["5. ",(0,s.jsx)(n.code,{children:"output_fn"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Format the model predictions into a response format for the frontend.\r\n",(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"predictions"})," - The output from ",(0,s.jsx)(n.code,{children:"predict_fn"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"original_data"})," - The original request data for reference."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resources"})," (optional) - Additional resources loaded by ",(0,s.jsx)(n.code,{children:"init_resources_fn"}),".\r\n",(0,s.jsx)(n.strong,{children:"Output"})]}),"\n",(0,s.jsxs)(n.li,{children:["the output is a (JSON-like) list of sections following the same structure as ",(0,s.jsx)(n.a,{href:"/docs/references/model_findings",children:"The model findings JSON file"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Output predictions and calculate derived metrics."}),"\n",(0,s.jsx)(n.li,{children:"Create sections for insights display."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'def output_fn(predictions, original_data, resources):\r\n    #  Transform predictions from Celsius to Fahrenheit\r\n    predicted_Celsius = predictions[\'predicted_Celsius\']\r\n    predicted_Fahrenheit = [(pred * 9.0 / 5.0) + 32 for pred in predicted_Celsius]\r\n\r\n    # Create response structure\r\n    response = []\r\n    # Add section for a table displaying predictions in Celsius and Fahrenheit\r\n    results_section = {\r\n        "type": "section",\r\n        "id": "results",\r\n        "title": "Prediction Results",\r\n        "color": "green",  # Optional: color for section header\r\n        "description": "Model prediction for temperature in Celsius and Fahrenheit.",\r\n        "items": [\r\n            {\r\n                "type": "table",\r\n                "id": "prediction_table",\r\n                "title": "Prediction Summary",\r\n                "data": {\r\n                    "columns": [\r\n                        {"header": "Metric", "field": "metric"},\r\n                        {"header": "Value", "field": "value"},\r\n                        {"header": "Unit", "field": "unit"}\r\n                    ],\r\n                    "rows": [\r\n                        {\r\n                            "metric": "Temperature (Celsius)",\r\n                            "value": f"{float(predicted_Celsius):.4f}",\r\n                            "unit": "\xb0C"\r\n                        },\r\n                        {\r\n                            "metric": "Temperature (Fahrenheit)",\r\n                            "value": f"{float(predicted_Fahrenheit):.4f}",\r\n                            "unit": "\xb0F"\r\n                        }\r\n                    ]\r\n                }\r\n            }\r\n        ]\r\n    }\r\n    response.append(results_section)\r\n    return response\n'})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error Handling"}),": Use ",(0,s.jsx)(n.code,{children:"try-except"})," blocks to handle exceptions gracefully."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validation"}),": Ensure input data is consistent and meets the model's requirements."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"chanterelle-integration",children:"Chanterelle Integration"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"handler_io.py"})," file is typically used in conjunction with a base handler (",(0,s.jsx)(n.code,{children:"python_handler_base.py"}),") that calls its functions automatically. Ensure the file is placed in the correct project directory and the model files are accessible."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>l});var i=r(6540);const s={},t=i.createContext(s);function d(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);